<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>來農場吧</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="js/jquery.min.js"></script>

</head>
<body>
    @@include('layout/header.html')
    <div class="wrap">
            <div class="box">
                <div class="item">
                  <button>橘子</button>
                  <button>蘋果</button>
                  <button>水蜜桃</button>
                  <button>芒果</button>
                  <button>紅棗</button>
                    <!-- <label for="">選擇水果</label>
                    <select>
                        <option>橘子</option>
                        <option>蘋果</option>
                        <option>水蜜桃</option>
                        <option>芒果</option>
                        <option>紅棗</option>
                    </select>  -->
                </div>

            </div>
            <div class="box">
                <div id="app" class="item">
                    <div id="map" class="embed-responsive embed-responsive-16by9"></div>
                </div>

            </div>

    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBv2stNGlktQxxtTVKeDxvMrizohjEK1uI" async defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.min.js"></script>
    <script>
      const googleMap = new Vue({
        el: '#app',
        data: {
          map: null,
          features: [], // 存入每一個地點
          infowindowAll: {} // 存入每一個marker上的info windows
        },
        methods: {
          
          initMap() {
            
            // 預設顯示的地點：山頂厝
            let location = {
              lat: 24.959575811515265, // 經度
              lng: 121.39485474187818 // 緯度
            };
            
            this.map = new google.maps.Map(document.getElementById('map'), {
              center: location,
              zoom: 10,
              mapTypeId: 'roadmap',
              mapTypeControl: false,
              streetViewControl: false,
              fullscreenControl: false

            });

            
            fetch('./map.geojson')
              .then(results => results.json())
              .then(result => {
                this.features = result.features;
                Array.prototype.forEach.call(this.features, r => {
                  let latLng = new google.maps.LatLng(r.geometry.coordinates[0], r.geometry.coordinates[1]);
                  let marker = new google.maps.Marker({
                    position: latLng,
                    map: this.map,
                    animation: google.maps.Animation.DROP
                    
                  });

                  // info window
                  let infowindow = new google.maps.InfoWindow({
                    
                    content: `<div class="col">
                        <div class="img" style="background-image: url('${r.properties.image}');"></div>
                        <div class="info">
                            <h3>${r.properties.name}</h3>
                            <p>地址：<br>${r.properties.site}</p>
                            <div class="btn">
                            <button onclick="window.open('${r.properties.location}')">農場詳情</button></div>
                        </div>
                    </div>` 
                  });

                  
                  marker.addListener('click', e => {
                    infowindow.open(this.map, marker);
                  });

                });

            });

          },
          

        },
        created() {
          window.addEventListener('load', () => {
            this.initMap();
          });
        }
      });
    </script>
    <link rel="stylesheet" href="css/farmsearch.css">

</body>
</html>